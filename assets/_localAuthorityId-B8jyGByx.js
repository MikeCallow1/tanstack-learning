import{r as $e,b as A,c as Ne,d as Le,e as Me,f as Re,g as Ke,h as ze,i as ge,k as Ue,l as ye,m as qe,n as I,S as We,D as ae,j as M,o as le,u as He,p as Ge,a as Qe}from"./index-DY-IX5vP.js";import{u as be,g as Ze,a as Je}from"./api-CezHEx1r.js";const Xe="Error preloading route! ☝️";var Ye=$e();function et(i,n){const s=Ne(),[e,a]=A.useState(!1),t=A.useRef(!1),r=Le(n),{activeProps:u=()=>({className:"active"}),inactiveProps:m=()=>({}),activeOptions:c,to:d,preload:h,preloadDelay:o,hashScrollIntoView:l,replace:f,startTransition:v,resetScroll:p,viewTransition:b,children:g,target:V,disabled:S,style:j,className:O,onClick:x,onFocus:E,onMouseEnter:T,onMouseLeave:k,onTouchStart:P,ignoreBlocker:$,...N}=i,{params:_e,search:y,hash:_,state:St,mask:Vt,reloadDocument:wt,...ce}=N,de=A.useMemo(()=>{try{return new URL(`${d}`),"external"}catch{}return"internal"},[d]),je=Me({select:F=>F.location.search,structuralSharing:!0}),he=Re({select:F=>{var w;return i.from??((w=F[F.length-1])==null?void 0:w.fullPath)}}),B=A.useMemo(()=>({...i,from:he}),[i,he]),C=A.useMemo(()=>s.buildLocation(B),[s,B,je]),L=A.useMemo(()=>B.reloadDocument?!1:h??s.options.defaultPreload,[s.options.defaultPreload,h,B.reloadDocument]),Te=o??s.options.defaultPreloadDelay??0,Z=Me({select:F=>{if(c!=null&&c.exact){if(!Ue(F.location.pathname,C.pathname,s.basepath))return!1}else{const w=ye(F.location.pathname,s.basepath).split("/");if(!ye(C.pathname,s.basepath).split("/").every((Ce,De)=>Ce===w[De]))return!1}return((c==null?void 0:c.includeSearch)??!0)&&!qe(F.location.search,C.search,{partial:!(c!=null&&c.exact),ignoreUndefined:!(c!=null&&c.explicitUndefined)})?!1:c!=null&&c.includeHash?F.location.hash===C.hash:!0}}),D=A.useCallback(()=>{s.preloadRoute(B).catch(F=>{console.warn(F),console.warn(Xe)})},[B,s]),ke=A.useCallback(F=>{F!=null&&F.isIntersecting&&D()},[D]);if(Ke(r,ke,{rootMargin:"100px"},{disabled:!!S||L!=="viewport"}),ze(()=>{t.current||!S&&L==="render"&&(D(),t.current=!0)},[S,D,L]),de==="external")return{...ce,ref:r,type:de,href:d,...g&&{children:g},...V&&{target:V},...S&&{disabled:S},...j&&{style:j},...O&&{className:O},...x&&{onClick:x},...E&&{onFocus:E},...T&&{onMouseEnter:T},...k&&{onMouseLeave:k},...P&&{onTouchStart:P}};const Pe=F=>{if(!S&&!tt(F)&&!F.defaultPrevented&&(!V||V==="_self")&&F.button===0){F.preventDefault(),Ye.flushSync(()=>{a(!0)});const w=s.subscribe("onResolved",()=>{w(),a(!1)});return s.navigate({...B,replace:f,resetScroll:p,hashScrollIntoView:l,startTransition:v,viewTransition:b,ignoreBlocker:$})}},fe=F=>{S||L&&D()},Ie=fe,Oe=F=>{if(S)return;const w=F.target||{};if(L){if(w.preloadTimeout)return;w.preloadTimeout=setTimeout(()=>{w.preloadTimeout=null,D()},Te)}},Be=F=>{if(S)return;const w=F.target||{};w.preloadTimeout&&(clearTimeout(w.preloadTimeout),w.preloadTimeout=null)},R=F=>w=>{var Y;(Y=w.persist)==null||Y.call(w),F.filter(Boolean).forEach(pe=>{w.defaultPrevented||pe(w)})},J=Z?ge(u,{})??{}:{},X=Z?{}:ge(m,{}),me=[O,J.className,X.className].filter(Boolean).join(" "),ve={...j,...J.style,...X.style};return{...ce,...J,...X,href:S?void 0:C.maskedLocation?s.history.createHref(C.maskedLocation.href):s.history.createHref(C.href),ref:r,onClick:R([x,Pe]),onFocus:R([E,fe]),onMouseEnter:R([T,Oe]),onMouseLeave:R([k,Be]),onTouchStart:R([P,Ie]),disabled:!!S,target:V,...Object.keys(ve).length&&{style:ve},...me&&{className:me},...S&&{role:"link","aria-disabled":!0},...Z&&{"data-status":"active","aria-current":"page"},...e&&{"data-transitioning":"transitioning"}}}const z=A.forwardRef((i,n)=>{const{_asChild:s,...e}=i,{type:a,ref:t,...r}=et(e,n),u=typeof e.children=="function"?e.children({isActive:r["data-status"]==="active"}):e.children;return typeof s>"u"&&delete r.disabled,A.createElement(s||"a",{...r,ref:t},u)});function tt(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function Q(i,n){return typeof i=="function"?i(n):i}function Ve(i,n){return ue(n).reduce((e,a)=>{if(e===null)return null;if(typeof e<"u")return e[a]},i)}function ee(i,n,s){const e=ue(n);function a(t){if(!e.length)return Q(s,t);const r=e.shift();if(typeof r=="string"||typeof r=="number"&&!Array.isArray(t))return typeof t=="object"?(t===null&&(t={}),{...t,[r]:a(t[r])}):{[r]:a()};if(Array.isArray(t)&&typeof r=="number"){const u=t.slice(0,r);return[...u.length?u:new Array(r),a(t[r]),...t.slice(r+1)]}return[...new Array(r),a()]}return a(i)}function st(i,n){const s=ue(n);function e(a){if(!a)return;if(s.length===1){const r=s[0];if(Array.isArray(a)&&typeof r=="number")return a.filter((c,d)=>d!==r);const{[r]:u,...m}=a;return m}const t=s.shift();if(typeof t=="string"&&typeof a=="object")return{...a,[t]:e(a[t])};if(typeof t=="number"&&Array.isArray(a)){if(t>=a.length)return a;const r=a.slice(0,t);return[...r.length?r:new Array(t),e(a[t]),...a.slice(t+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(i)}const at=/^(\d*)$/gm,it=/\.(\d*)\./gm,rt=/^(\d*)\./gm,nt=/\.(\d*$)/gm,ot=/\.{2,}/gm,ie="__int__",U=`${ie}$1`;function ue(i){if(Array.isArray(i))return[...i];if(typeof i!="string")throw new Error("Path must be a string.");return i.replace(/\[/g,".").replace(/\]/g,"").replace(at,U).replace(it,`.${U}.`).replace(rt,`${U}.`).replace(nt,`.${U}`).replace(ot,".").split(".").map(n=>n.indexOf(ie)===0?parseInt(n.substring(ie.length),10):n)}function lt(i){return!(Array.isArray(i)&&i.length===0)}function re(i,n){const{asyncDebounceMs:s}=n,{onChangeAsync:e,onBlurAsync:a,onSubmitAsync:t,onBlurAsyncDebounceMs:r,onChangeAsyncDebounceMs:u}=n.validators||{},m=s??0,c={cause:"change",validate:e,debounceMs:u??m},d={cause:"blur",validate:a,debounceMs:r??m},h={cause:"submit",validate:t,debounceMs:0},o=l=>({...l,debounceMs:0});switch(i){case"submit":return[o(c),o(d),h];case"blur":return[d];case"change":return[c];case"server":default:return[]}}function ne(i,n){const{onChange:s,onBlur:e,onSubmit:a,onMount:t}=n.validators||{},r={cause:"change",validate:s},u={cause:"blur",validate:e},m={cause:"submit",validate:a},c={cause:"mount",validate:t},d={cause:"server",validate:()=>{}};switch(i){case"mount":return[c];case"submit":return[r,u,m,d];case"server":return[d];case"blur":return[u,d];case"change":default:return[r,d]}}const we=i=>!!i&&typeof i=="object"&&"fields"in i;function te(i,n){if(Object.is(i,n))return!0;if(typeof i!="object"||i===null||typeof n!="object"||n===null)return!1;if(i instanceof Map&&n instanceof Map){if(i.size!==n.size)return!1;for(const[e,a]of i)if(!n.has(e)||!Object.is(a,n.get(e)))return!1;return!0}if(i instanceof Set&&n instanceof Set){if(i.size!==n.size)return!1;for(const e of i)if(!n.has(e))return!1;return!0}const s=Object.keys(i);if(s.length!==Object.keys(n).length)return!1;for(let e=0;e<s.length;e++)if(!Object.prototype.hasOwnProperty.call(n,s[e])||!Object.is(i[s[e]],n[s[e]]))return!1;return!0}function ut(i){const n=new Map;for(const s of i){const e=[...s.path??[]].map(a=>{const t=typeof a=="object"?a.key:a;return typeof t=="number"?`[${t}]`:t}).join(".").replace(/\.\[/g,"[");n.set(e,(n.get(e)??[]).concat(s))}return Object.fromEntries(n)}const ct=i=>i,dt=i=>{const n=ut(i);return{form:n,fields:n}},Fe=(i,n)=>i==="form"?dt(n):ct(n),Ee={validate({value:i,validationSource:n},s){const e=s["~standard"].validate(i);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return Fe(n,e.issues)},async validateAsync({value:i,validationSource:n},s){const e=await s["~standard"].validate(i);if(e.issues)return Fe(n,e.issues)}},Ae=i=>!!i&&"~standard"in i,H={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,errors:[],errorMap:{}};function q(i){function n(h,o,l,f){const v=e(h,o,l,f);({insert:()=>u(v,h,o),remove:()=>m(v),swap:()=>f!==void 0&&d(v,h,o,f),move:()=>f!==void 0&&c(v,h,o,f)})[l]()}function s(h,o){return`${h}[${o}]`}function e(h,o,l,f){const v=[s(h,o)];if(l==="swap")v.push(s(h,f));else if(l==="move"){const[p,b]=[Math.min(o,f),Math.max(o,f)];for(let g=p;g<=b;g++)v.push(s(h,g))}else{const p=i.getFieldValue(h),b=Array.isArray(p)?p.length:0;for(let g=o+1;g<b;g++)v.push(s(h,g))}return Object.keys(i.fieldInfo).filter(p=>v.some(b=>p.startsWith(b)))}function a(h,o){return h.replace(/\[(\d+)\]/,(l,f)=>{const v=parseInt(f,10);return`[${o==="up"?v+1:Math.max(0,v-1)}]`})}function t(h,o){(o==="up"?h:[...h].reverse()).forEach(f=>{const v=a(f.toString(),o),p=i.getFieldMeta(v);p?i.setFieldMeta(f,p):i.setFieldMeta(f,r())})}const r=()=>H,u=(h,o,l)=>{t(h,"down"),h.forEach(f=>{f.toString().startsWith(s(o,l))&&i.setFieldMeta(f,r())})},m=h=>{t(h,"up")},c=(h,o,l,f)=>{const v=new Map(Object.keys(i.fieldInfo).filter(p=>p.startsWith(s(o,l))).map(p=>[p,i.getFieldMeta(p)]));t(h,l<f?"up":"down"),Object.keys(i.fieldInfo).filter(p=>p.startsWith(s(o,f))).forEach(p=>{const b=p.replace(s(o,f),s(o,l)),g=v.get(b);g&&i.setFieldMeta(p,g)})},d=(h,o,l,f)=>{h.forEach(v=>{if(!v.toString().startsWith(s(o,l)))return;const p=v.toString().replace(s(o,l),s(o,f)),[b,g]=[i.getFieldMeta(v),i.getFieldMeta(p)];b&&i.setFieldMeta(p,b),g&&i.setFieldMeta(v,g)})};return{handleArrayFieldMetaShift:n}}function se(i){return{values:i.values??{},errorMap:i.errorMap??{},fieldMetaBase:i.fieldMetaBase??{},isSubmitted:i.isSubmitted??!1,isSubmitting:i.isSubmitting??!1,isValidating:i.isValidating??!1,submissionAttempts:i.submissionAttempts??0,isSubmitSuccessful:i.isSubmitSuccessful??!1,validationMetaMap:i.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}}}class ht{constructor(n){var s;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.cumulativeFieldsErrorMap={},this.mount=()=>{const e=this.fieldMetaDerived.mount(),a=this.store.mount(),t=()=>{e(),a()},{onMount:r}=this.options.validators||{};return r&&this.validateSync("mount"),t},this.update=e=>{var a,t;if(!e)return;const r=this.options;this.options=e;const u=!!((t=(a=e.transform)==null?void 0:a.deps)!=null&&t.some((d,h)=>d!==this.prevTransformArray[h])),m=e.defaultValues&&!te(e.defaultValues,r.defaultValues)&&!this.state.isTouched,c=!te(e.defaultState,r.defaultState)&&!this.state.isTouched;!m&&!c&&!u||I(()=>{this.baseStore.setState(()=>se(Object.assign({},this.state,c?e.defaultState:{},m?{values:e.defaultValues}:{},u?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,a)=>{const{fieldMeta:t}=this.state,r=this.resetFieldMeta(t);e&&!(a!=null&&a.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var u;return se({...this.options.defaultState,values:e??this.options.defaultValues??((u=this.options.defaultState)==null?void 0:u.values),fieldMetaBase:r})})},this.validateAllFields=async e=>{const a=[];return I(()=>{Object.values(this.fieldInfo).forEach(r=>{if(!r.instance)return;const u=r.instance;a.push(Promise.resolve().then(()=>u.validate(e,{skipFormValidation:!0}))),r.instance.state.meta.isTouched||r.instance.setMeta(m=>({...m,isTouched:!0}))})}),(await Promise.all(a)).flat()},this.validateArrayFieldsStartingFrom=async(e,a,t)=>{const r=this.getFieldValue(e),u=Array.isArray(r)?Math.max(r.length-1,0):null,m=[`${e}[${a}]`];for(let o=a+1;o<=(u??0);o++)m.push(`${e}[${o}]`);const c=Object.keys(this.fieldInfo).filter(o=>m.some(l=>o.startsWith(l))),d=[];return I(()=>{c.forEach(o=>{d.push(Promise.resolve().then(()=>this.validateField(o,t)))})}),(await Promise.all(d)).flat()},this.validateField=(e,a)=>{var t;const r=(t=this.fieldInfo[e])==null?void 0:t.instance;return r?(r.state.meta.isTouched||r.setMeta(u=>({...u,isTouched:!0})),r.validate(a)):[]},this.validateSync=e=>{const a=ne(e,this.options);let t=!1;const r={};return I(()=>{var u;for(const c of a){if(!c.validate)continue;const d=this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:h,fieldErrors:o}=oe(d),l=W(c.cause);if(o)for(const[f,v]of Object.entries(o)){const b={...this.cumulativeFieldsErrorMap[f]||{},[l]:v};r[f]=b,this.cumulativeFieldsErrorMap[f]=b;const g=this.getFieldMeta(f);g&&g.errorMap[l]!==v&&this.setFieldMeta(f,V=>({...V,errorMap:{...V.errorMap,[l]:v}}))}for(const f of Object.keys(this.cumulativeFieldsErrorMap)){const v=this.getFieldMeta(f);v!=null&&v.errorMap[l]&&!((u=r[f])!=null&&u[l])&&(this.cumulativeFieldsErrorMap[f]={...this.cumulativeFieldsErrorMap[f],[l]:void 0},this.setFieldMeta(f,p=>({...p,errorMap:{...p.errorMap,[l]:void 0}})))}this.state.errorMap[l]!==h&&this.baseStore.setState(f=>({...f,errorMap:{...f.errorMap,[l]:h}})),(h||o)&&(t=!0)}const m=W("submit");this.state.errorMap[m]&&e!=="submit"&&!t&&this.baseStore.setState(c=>({...c,errorMap:{...c.errorMap,[m]:void 0}}))}),{hasErrored:t,fieldsErrorMap:r}},this.validateAsync=async e=>{const a=re(e,this.options);this.state.isFormValidating||this.baseStore.setState(c=>({...c,isFormValidating:!0}));const t=[];let r;for(const c of a){if(!c.validate)continue;const d=W(c.cause),h=this.state.validationMetaMap[d];h==null||h.lastAbortController.abort();const o=new AbortController;this.state.validationMetaMap[d]={lastAbortController:o},t.push(new Promise(async l=>{let f;try{f=await new Promise((g,V)=>{setTimeout(async()=>{if(o.signal.aborted)return g(void 0);try{g(await this.runValidator({validate:c.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:o.signal},type:"validateAsync"}))}catch(S){V(S)}},c.debounceMs)})}catch(g){f=g}const{formError:v,fieldErrors:p}=oe(f);p&&(r=r?{...r,...p}:p);const b=W(c.cause);if(r)for(const[g,V]of Object.entries(r)){const S=this.getFieldMeta(g);S&&S.errorMap[b]!==V&&this.setFieldMeta(g,j=>({...j,errorMap:{...j.errorMap,[b]:V}}))}this.baseStore.setState(g=>({...g,errorMap:{...g.errorMap,[b]:v}})),l(r?{fieldErrors:r,errorMapKey:b}:void 0)}))}let u=[];const m={};if(t.length){u=await Promise.all(t);for(const c of u)if(c!=null&&c.fieldErrors){const{errorMapKey:d}=c;for(const[h,o]of Object.entries(c.fieldErrors)){const f={...m[h]||{},[d]:o};m[h]=f}}}return this.baseStore.setState(c=>({...c,isFormValidating:!1})),m},this.validate=e=>{const{hasErrored:a,fieldsErrorMap:t}=this.validateSync(e);return a&&!this.options.asyncAlways?t:this.validateAsync(e)},this.getFieldValue=e=>Ve(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var a;return(a=this.fieldInfo)[e]||(a[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0}})},this.setFieldMeta=(e,a)=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:Q(a,t.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((a,t)=>{const r=t;return a[r]=H,a},{}),this.setFieldValue=(e,a,t)=>{const r=(t==null?void 0:t.dontUpdateMeta)??!1;I(()=>{r||this.setFieldMeta(e,u=>({...u,isTouched:!0,isDirty:!0,errorMap:{...u==null?void 0:u.errorMap,onMount:void 0}})),this.baseStore.setState(u=>({...u,values:ee(u.values,e,a)}))})},this.deleteField=e=>{const t=[...Object.keys(this.fieldInfo).filter(r=>{const u=e.toString();return r!==u&&r.startsWith(u)}),e];this.baseStore.setState(r=>{const u={...r};return t.forEach(m=>{u.values=st(u.values,m),delete this.fieldInfo[m],delete u.fieldMetaBase[m]}),u})},this.pushFieldValue=(e,a,t)=>{this.setFieldValue(e,r=>[...Array.isArray(r)?r:[],a],t),this.validateField(e,"change")},this.insertFieldValue=async(e,a,t,r)=>{this.setFieldValue(e,u=>[...u.slice(0,a),t,...u.slice(a)],r),await this.validateField(e,"change"),q(this).handleArrayFieldMetaShift(e,a,"insert"),await this.validateArrayFieldsStartingFrom(e,a,"change")},this.replaceFieldValue=async(e,a,t,r)=>{this.setFieldValue(e,u=>u.map((m,c)=>c===a?t:m),r),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,a,"change")},this.removeFieldValue=async(e,a,t)=>{const r=this.getFieldValue(e),u=Array.isArray(r)?Math.max(r.length-1,0):null;if(this.setFieldValue(e,m=>m.filter((c,d)=>d!==a),t),q(this).handleArrayFieldMetaShift(e,a,"remove"),u!==null){const m=`${e}[${u}]`;this.deleteField(m)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,a,"change")},this.swapFieldValues=(e,a,t,r)=>{this.setFieldValue(e,u=>{const m=u[a],c=u[t];return ee(ee(u,`${a}`,c),`${t}`,m)},r),q(this).handleArrayFieldMetaShift(e,a,"swap",t),this.validateField(e,"change"),this.validateField(`${e}[${a}]`,"change"),this.validateField(`${e}[${t}]`,"change")},this.moveFieldValues=(e,a,t,r)=>{this.setFieldValue(e,u=>(u.splice(t,0,u.splice(a,1)[0]),u),r),q(this).handleArrayFieldMetaShift(e,a,"move",t),this.validateField(e,"change"),this.validateField(`${e}[${a}]`,"change"),this.validateField(`${e}[${t}]`,"change")},this.resetField=e=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:H},values:{...a.values,[e]:this.options.defaultValues&&this.options.defaultValues[e]}}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[a,t])=>(Object.keys(t).length&&t.errors.length&&(e[a]={errors:t.errors,errorMap:t.errorMap}),e),{})}),this.baseStore=new We(se({...n==null?void 0:n.defaultState,values:(n==null?void 0:n.defaultValues)??((s=n==null?void 0:n.defaultState)==null?void 0:s.values)})),this.fieldMetaDerived=new ae({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:a,prevVal:t})=>{var r;const u=t,m=e==null?void 0:e[0],c=a[0];let d=0;const h={};for(const o of Object.keys(c.fieldMetaBase)){const l=c.fieldMetaBase[o],f=m==null?void 0:m.fieldMetaBase[o],v=u==null?void 0:u[o];let p=v==null?void 0:v.errors;if(!f||l.errorMap!==f.errorMap){p=Object.values(l.errorMap??{}).filter(V=>V!==void 0);const g=(r=this.getFieldInfo(o))==null?void 0:r.instance;g&&!g.options.disableErrorFlat&&(p=p==null?void 0:p.flat(1))}const b=!l.isDirty;if(v&&v.isPristine===b&&v.errors===p&&l===f){h[o]=v,d++;continue}h[o]={...l,errors:p,isPristine:b}}return Object.keys(c.fieldMetaBase).length&&u&&d===Object.keys(c.fieldMetaBase).length?u:h}}),this.store=new ae({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:a,prevVal:t})=>{var r,u,m,c;const d=t,h=e==null?void 0:e[0],o=a[0],l=Object.values(o.fieldMetaBase),f=l.some(y=>y==null?void 0:y.isValidating),v=!l.some(y=>(y==null?void 0:y.errorMap)&&lt(Object.values(y.errorMap).filter(Boolean))),p=l.some(y=>y==null?void 0:y.isTouched),b=l.some(y=>y==null?void 0:y.isBlurred),g=p&&((r=o==null?void 0:o.errorMap)==null?void 0:r.onMount),V=l.some(y=>y==null?void 0:y.isDirty),S=!V,j=!!((u=o.errorMap)!=null&&u.onMount||l.some(y=>{var _;return(_=y==null?void 0:y.errorMap)==null?void 0:_.onMount})),O=!!f;let x=(d==null?void 0:d.errors)??[];(!h||o.errorMap!==h.errorMap)&&(x=Object.values(o.errorMap).reduce((y,_)=>_===void 0?y:_&&we(_)?(y.push(_.form),y):(y.push(_),y),[]));const E=x.length===0,T=v&&E,k=o.submissionAttempts===0&&!p&&!j||!O&&!o.isSubmitting&&T;let P=o.errorMap;if(g&&(x=x.filter(y=>y!==o.errorMap.onMount),P=Object.assign(P,{onMount:void 0})),d&&h&&d.errorMap===P&&d.fieldMeta===this.fieldMetaDerived.state&&d.errors===x&&d.isFieldsValidating===f&&d.isFieldsValid===v&&d.isFormValid===E&&d.isValid===T&&d.canSubmit===k&&d.isTouched===p&&d.isBlurred===b&&d.isPristine===S&&d.isDirty===V&&te(h,o))return d;let $={...o,errorMap:P,fieldMeta:this.fieldMetaDerived.state,errors:x,isFieldsValidating:f,isFieldsValid:v,isFormValid:E,isValid:T,canSubmit:k,isTouched:p,isBlurred:b,isPristine:S,isDirty:V};const N=((m=this.options.transform)==null?void 0:m.deps)??[];if(N.length!==this.prevTransformArray.length||N.some((y,_)=>y!==this.prevTransformArray[_])){const y=Object.assign({},this,{state:$});(c=this.options.transform)==null||c.fn(y),$=y.state,this.prevTransformArray=N}return $}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(n||{})}get state(){return this.store.state}runValidator(n){return Ae(n.validate)?Ee[n.type](n.value,n.validate):n.validate(n.value)}async handleSubmit(n){var s,e,a,t,r,u;if(this.baseStore.setState(c=>({...c,isSubmitted:!1,submissionAttempts:c.submissionAttempts+1,isSubmitSuccessful:!1})),!this.state.canSubmit)return;this.baseStore.setState(c=>({...c,isSubmitting:!0}));const m=()=>{this.baseStore.setState(c=>({...c,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){m(),(e=(s=this.options).onSubmitInvalid)==null||e.call(s,{value:this.state.values,formApi:this});return}if(await this.validate("submit"),!this.state.isValid){m(),(t=(a=this.options).onSubmitInvalid)==null||t.call(a,{value:this.state.values,formApi:this});return}I(()=>{Object.values(this.fieldInfo).forEach(c=>{var d,h,o;(o=(h=(d=c.instance)==null?void 0:d.options.listeners)==null?void 0:h.onSubmit)==null||o.call(h,{value:c.instance.state.value,fieldApi:c.instance})})});try{await((u=(r=this.options).onSubmit)==null?void 0:u.call(r,{value:this.state.values,formApi:this,meta:n??this.options.onSubmitMeta})),I(()=>{this.baseStore.setState(c=>({...c,isSubmitted:!0,isSubmitSuccessful:!0})),m()})}catch(c){throw this.baseStore.setState(d=>({...d,isSubmitSuccessful:!1})),m(),c}}setErrorMap(n){this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,...n}}))}}function oe(i){if(i){if(we(i)){const n=oe(i.form).formError,s=i.fields;return{formError:n,fieldErrors:s}}return{formError:i}}return{formError:void 0}}function W(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}class ft{constructor(n){this.options={},this.mount=()=>{var s,e;const a=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const t=this.getInfo();t.instance=this,this.update(this.options);const{onMount:r}=this.options.validators||{};if(r){const u=this.runValidator({validate:r,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});u&&this.setMeta(m=>({...m,errorMap:{...m==null?void 0:m.errorMap,onMount:u}}))}return(e=(s=this.options.listeners)==null?void 0:s.onMount)==null||e.call(s,{value:this.state.value,fieldApi:this}),a},this.update=s=>{if(this.state.value===void 0){const e=Ve(s.form.options.defaultValues,s.name);s.defaultValue!==void 0?this.setValue(s.defaultValue,{dontUpdateMeta:!0}):e!==void 0&&this.setValue(e,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta),this.options=s,this.name=s.name},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(s,e)=>{var a,t;this.form.setFieldValue(this.name,s,e),(t=(a=this.options.listeners)==null?void 0:a.onChange)==null||t.call(a,{value:this.state.value,fieldApi:this}),this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=s=>this.form.setFieldMeta(this.name,s),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(s,e)=>{var a,t;this.form.pushFieldValue(this.name,s,e),(t=(a=this.options.listeners)==null?void 0:a.onChange)==null||t.call(a,{value:this.state.value,fieldApi:this})},this.insertValue=(s,e,a)=>{var t,r;this.form.insertFieldValue(this.name,s,e,a),(r=(t=this.options.listeners)==null?void 0:t.onChange)==null||r.call(t,{value:this.state.value,fieldApi:this})},this.replaceValue=(s,e,a)=>{var t,r;this.form.replaceFieldValue(this.name,s,e,a),(r=(t=this.options.listeners)==null?void 0:t.onChange)==null||r.call(t,{value:this.state.value,fieldApi:this})},this.removeValue=(s,e)=>{var a,t;this.form.removeFieldValue(this.name,s,e),(t=(a=this.options.listeners)==null?void 0:a.onChange)==null||t.call(a,{value:this.state.value,fieldApi:this})},this.swapValues=(s,e,a)=>{var t,r;this.form.swapFieldValues(this.name,s,e,a),(r=(t=this.options.listeners)==null?void 0:t.onChange)==null||r.call(t,{value:this.state.value,fieldApi:this})},this.moveValue=(s,e,a)=>{var t,r;this.form.moveFieldValues(this.name,s,e,a),(r=(t=this.options.listeners)==null?void 0:t.onChange)==null||r.call(t,{value:this.state.value,fieldApi:this})},this.getLinkedFields=s=>{const e=Object.values(this.form.fieldInfo),a=[];for(const t of e){if(!t.instance)continue;const{onChangeListenTo:r,onBlurListenTo:u}=t.instance.options.validators||{};s==="change"&&(r!=null&&r.includes(this.name))&&a.push(t.instance),s==="blur"&&(u!=null&&u.includes(this.name))&&a.push(t.instance)}return a},this.validateSync=(s,e)=>{const a=ne(s,this.options),r=this.getLinkedFields(s).reduce((c,d)=>{const h=ne(s,d.options);return h.forEach(o=>{o.field=d}),c.concat(h)},[]);let u=!1;I(()=>{const c=(d,h)=>{const o=K(h.cause),l=h.validate?Se(d.runValidator({validate:h.validate,value:{value:d.store.state.value,validationSource:"field",fieldApi:d},type:"validate"})):e[o];d.state.meta.errorMap[o]!==l&&d.setMeta(f=>({...f,errorMap:{...f.errorMap,[K(h.cause)]:l||e[o]}})),(l||e[o])&&(u=!0)};for(const d of a)c(this,d);for(const d of r)d.validate&&c(d.field,d)});const m=K("submit");return this.state.meta.errorMap[m]&&s!=="submit"&&!u&&this.setMeta(c=>({...c,errorMap:{...c.errorMap,[m]:void 0}})),{hasErrored:u}},this.validateAsync=async(s,e)=>{const a=re(s,this.options),t=await e,r=this.getLinkedFields(s),u=r.reduce((o,l)=>{const f=re(s,l.options);return f.forEach(v=>{v.field=l}),o.concat(f)},[]);this.state.meta.isValidating||this.setMeta(o=>({...o,isValidating:!0}));for(const o of r)o.setMeta(l=>({...l,isValidating:!0}));const m=[],c=[],d=(o,l,f)=>{const v=K(l.cause),p=o.getInfo().validationMetaMap[v];p==null||p.lastAbortController.abort();const b=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:b},f.push(new Promise(async g=>{var V;let S;try{S=await new Promise((E,T)=>{this.timeoutIds[l.cause]&&clearTimeout(this.timeoutIds[l.cause]),this.timeoutIds[l.cause]=setTimeout(async()=>{if(b.signal.aborted)return E(void 0);try{E(await this.runValidator({validate:l.validate,value:{value:o.store.state.value,fieldApi:o,signal:b.signal,validationSource:"field"},type:"validateAsync"}))}catch(k){T(k)}},l.debounceMs)})}catch(E){S=E}if(b.signal.aborted)return g(void 0);const j=Se(S),O=(V=t[this.name])==null?void 0:V[v],x=j||O;o.setMeta(E=>({...E,errorMap:{...E==null?void 0:E.errorMap,[v]:x}})),g(x)}))};for(const o of a)o.validate&&d(this,o,m);for(const o of u)o.validate&&d(o.field,o,c);let h=[];(m.length||c.length)&&(h=await Promise.all(m),await Promise.all(c)),this.setMeta(o=>({...o,isValidating:!1}));for(const o of r)o.setMeta(l=>({...l,isValidating:!1}));return h.filter(Boolean)},this.validate=(s,e)=>{var a;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:t}=e!=null&&e.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(s),{hasErrored:r}=this.validateSync(s,t[this.name]??{});if(r&&!this.options.asyncAlways)return(a=this.getInfo().validationMetaMap[K(s)])==null||a.lastAbortController.abort(),this.state.meta.errors;const u=e!=null&&e.skipFormValidation?Promise.resolve({}):this.form.validateAsync(s);return this.validateAsync(s,u)},this.handleChange=s=>{this.setValue(s)},this.handleBlur=()=>{var s,e;this.state.meta.isTouched||(this.setMeta(t=>({...t,isTouched:!0})),this.validate("change")),this.state.meta.isBlurred||this.setMeta(t=>({...t,isBlurred:!0})),this.validate("blur"),(e=(s=this.options.listeners)==null?void 0:s.onBlur)==null||e.call(s,{value:this.state.value,fieldApi:this})},this.form=n.form,this.name=n.name,this.timeoutIds={},this.store=new ae({deps:[this.form.store],fn:()=>{const s=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...H,...n.defaultMeta};return{value:s,meta:e}}}),this.options=n}get state(){return this.store.state}runValidator(n){return Ae(n.validate)?Ee[n.type](n.value,n.validate):n.validate(n.value)}setErrorMap(n){this.setMeta(s=>({...s,errorMap:{...s.errorMap,...n}}))}}function Se(i){if(i)return i}function K(i){switch(i){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"change":default:return"onChange"}}const G=typeof window<"u"?A.useLayoutEffect:A.useEffect;function mt(i){const[n]=A.useState(()=>{const e=new ft({...i,form:i.form,name:i.name});return e.Field=xe,e});return G(n.mount,[n]),G(()=>{n.update(i)}),le(n.store,i.mode==="array"?s=>[s.meta,Object.keys(s.value??[]).length]:void 0),n}const xe=({children:i,...n})=>{const s=mt(n),e=A.useMemo(()=>Q(i,s),[i,s,s.state.value,s.state.meta]);return M.jsx(M.Fragment,{children:e})};function vt({form:i,selector:n,children:s}){const e=le(i.store,n);return Q(s,e)}function pt(i){const[n]=A.useState(()=>{const s=new ht(i),e=s;return e.Field=function(t){return M.jsx(xe,{...t,form:s})},e.Subscribe=a=>M.jsx(vt,{form:s,selector:a.selector,children:a.children}),e});return G(n.mount,[]),le(n.store,s=>s.isSubmitting),G(()=>{n.update(i)}),n}const Mt=({establishment:i})=>M.jsxs("li",{className:"border p-4 rounded shadow hover:shadow-lg transition",children:[M.jsx("h2",{className:"font-bold",children:i.BusinessName}),M.jsxs("p",{children:["Rating: ",i.RatingValue]}),M.jsxs("p",{children:["Type: ",i.BusinessType]}),M.jsxs("p",{children:["Postcode: ",i.PostCode]})]},i.FHRSID),gt=({data:i})=>{var n;return M.jsx("ul",{className:"mt-4 space-y-2",children:(n=i==null?void 0:i.establishments)==null?void 0:n.map(s=>M.jsx(Mt,{establishment:s},s.FHRSID))})},yt=({pageNumber:i,totalPages:n})=>M.jsxs("div",{className:"flex items-center justify-center space-x-4 p-4",children:[M.jsx(z,{className:`px-3 py-1 rounded ${i===1?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:i===1,search:{page:1},children:"First"}),M.jsx(z,{className:`px-3 py-1 rounded ${i===1?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:i===1,search:{page:Number(i-1)},children:"Prev"}),M.jsxs("span",{className:"px-3 py-1 text-gray-700",children:["Page ",i," of ",n]}),M.jsx(z,{className:`px-3 py-1 rounded ${i===n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:i===n,search:{page:Number(i+1)},children:"Next"}),M.jsx(z,{className:`px-3 py-1 rounded ${i===n?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:i===n,search:{page:Number(n)},children:"Last"})]}),bt=10,Ft=()=>{const{localAuthorityId:i}=He({from:"/establishments/$localAuthorityId"}),n=Ge({strict:!1}),s=Number(n.page)||1,e=n.name||"",a=n.sortOptionKey||"",{data:t,isLoading:r}=be({queryKey:["sortValues"],queryFn:()=>Ze()}),u=Qe(),m=pt({defaultValues:{name:n.name||"",sortBy:t==null?void 0:t.sortOptions},onSubmit:({value:l})=>{u({to:`/establishments/${i}`,search:{page:1,name:l.name,sortOptionKey:l.sortBy}})}}),{data:c,error:d,isLoading:h}=be({queryKey:["establishments",i,s,e,a],queryFn:()=>Je({localAuthorityId:Number(i),name:e,pageSize:bt,pageNumber:s,sortOptionKey:n.sortOptionKey})});if(h)return M.jsx("p",{children:"Loading establishments..."});if(d)return M.jsx("p",{children:"Error loading establishments."});const o=({field:l})=>M.jsx("div",{className:"flex items-center space-x-2 relative",children:M.jsxs("span",{className:"text-sm text-red-500 min-h-[1em] absolute top-0",children:[l.state.meta.isTouched&&l.state.meta.errors.length?l.state.meta.errors.join(", "):null,l.state.meta.isValidating?"Validating...":null]})});return M.jsxs("div",{className:"p-6",children:[M.jsx("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),m.handleSubmit()},className:"mt-4 space-y-4",children:M.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center space-y-4 md:space-y-0 md:space-x-6 bg-gray-100 p-4 rounded-lg shadow-md",children:[M.jsx(m.Field,{name:"name",children:l=>M.jsxs("div",{className:"flex flex-col w-full md:w-auto",children:[M.jsx("label",{htmlFor:l.name,className:"block text-sm font-medium text-gray-700",children:"Filter by Name"}),M.jsx("input",{id:l.name,name:l.name,value:l.state.value,onBlur:l.handleBlur,onChange:f=>l.handleChange(f.target.value),className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white px-3 py-1"}),M.jsx(o,{field:l})]})}),M.jsx(m.Field,{name:"sortBy",children:l=>{var f;return M.jsxs("div",{className:"flex flex-col w-full md:w-auto",children:[M.jsx("label",{htmlFor:l.name,className:"block text-sm font-medium text-gray-700",children:"Sort By"}),M.jsxs("select",{id:l.name,name:l.name,value:l.state.value,onBlur:l.handleBlur,onChange:v=>{l.handleChange(v.target.value)},className:"mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white px-3 py-1",children:[M.jsx("option",{value:"",children:"Select an option"}),(f=t==null?void 0:t.sortOptions)==null?void 0:f.map(v=>M.jsx("option",{value:v.sortOptionKey,children:v.sortOptionName},v.sortOptionId))]}),M.jsx(o,{field:l})]})}}),M.jsx(m.Subscribe,{selector:l=>[l.canSubmit,l.isSubmitting],children:([l,f])=>M.jsx("div",{className:"flex justify-end w-full md:w-auto",children:M.jsx("button",{type:"submit",disabled:!l,className:`px-4 py-2 text-white rounded-md shadow-sm ${l?"bg-blue-500 hover:bg-blue-600":"bg-gray-400 cursor-not-allowed"}`,children:f?"Submitting...":"Apply Filters"})})})]})}),M.jsx(gt,{data:c}),M.jsx(yt,{pageNumber:s,totalPages:(c==null?void 0:c.meta.totalPages)||1})]})},xt=function(){return M.jsx(Ft,{})};export{xt as component};
